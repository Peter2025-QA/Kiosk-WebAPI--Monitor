# Kiosk API 测试验证说明文档

## 📋 概述

本文档详细说明了Kiosk API测试项目中每个测试脚本的验证目的、API目标、验证点等信息，为测试人员提供清晰的测试指导。

## 🎯 测试模块分类

### 1. 登录模块 (Login) - 用户认证功能

#### 1.1 `tests/login/test_login_phone.py`
**验证目的：** 手机号登录功能测试
- **API目标：** `/auth/login/phone`
- **请求方法：** POST
- **验证点：**
  - ✅ 状态码是否为200（成功登录）
  - ✅ 响应中是否包含token字段
  - ✅ 无效验证码处理（返回401或404）
  - ✅ 无效手机号处理
  - ✅ 缺少验证码参数处理
  - ✅ 缺少手机号参数处理
  - ✅ 多个手机号登录测试
- **测试场景：**
  - 正常登录流程
  - 错误验证码处理
  - 参数缺失处理
  - 多用户并发测试

#### 1.2 `tests/login/test_login_email.py`
**验证目的：** 邮箱登录功能测试
- **API目标：** `/auth/login/email`
- **请求方法：** POST
- **验证点：**
  - ✅ 状态码是否为200（成功登录）
  - ✅ 响应中是否包含token字段
  - ✅ 无效凭据处理（返回401）
  - ✅ 缺少密码参数处理
  - ✅ 缺少邮箱参数处理
  - ✅ 多个邮箱登录测试
- **测试场景：**
  - 邮箱密码登录
  - 无效凭据处理
  - 参数验证
  - 多用户测试

#### 1.3 `tests/login/test_sign_in_with_email.py`
**验证目的：** 邮箱注册登录测试
- **API目标：** `/auth/sign-in-with-email`
- **请求方法：** POST
- **验证点：**
  - ✅ 新用户注册流程
  - ✅ 现有用户登录流程
  - ✅ 邮箱格式验证
- **测试场景：**
  - 新用户注册
  - 现有用户登录
  - 邮箱验证

#### 1.4 `tests/login/test_sign_in_with_phone.py`
**验证目的：** 手机号注册登录测试
- **API目标：** `/auth/sign-in-with-phone`
- **请求方法：** POST
- **验证点：**
  - ✅ 新用户注册流程
  - ✅ 现有用户登录流程
  - ✅ 手机号格式验证
- **测试场景：**
  - 新用户注册
  - 现有用户登录
  - 手机号验证

### 2. 验证模块 (Verification) - 验证码功能

#### 2.1 `tests/verification/test_send_code.py`
**验证目的：** 验证码发送功能测试
- **API目标：** 
  - `/auth/send-code/email` (邮箱验证码)
  - `/auth/send-code/phone` (手机验证码)
- **请求方法：** POST
- **验证点：**
  - ✅ 邮箱验证码发送成功
  - ✅ 手机验证码发送成功
  - ✅ 无效邮箱格式处理
  - ✅ 无效手机号格式处理
  - ✅ 缺少邮箱参数处理
  - ✅ 缺少手机号参数处理
  - ✅ 多个邮箱/手机号测试
- **测试场景：**
  - 邮箱验证码发送
  - 手机验证码发送
  - 格式验证
  - 参数验证
  - 批量发送测试

### 3. 位置模块 (Location) - 位置和设备管理

#### 3.1 `tests/location/test_get_location.py`
**验证目的：** 位置信息获取功能测试
- **API目标：** 
  - `/v1/location/info` (位置信息)
  - `/v1/location/settings` (位置设置)
- **请求方法：** GET
- **验证点：**
  - ✅ 获取位置基本信息
  - ✅ 带参数获取位置信息
  - ✅ 获取位置设置
  - ✅ 多个位置ID测试
  - ✅ 404端点处理
- **测试场景：**
  - 位置信息查询
  - 位置设置获取
  - 多位置测试
  - 错误处理

#### 3.2 `tests/location/test_upload_device.py`
**验证目的：** 设备信息上传功能测试
- **API目标：** 
  - `/v1/device/upload` (设备上传)
  - `/v1/device/status` (设备状态)
- **请求方法：** POST/GET
- **验证点：**
  - ✅ 设备信息上传成功
  - ✅ 带token的设备上传
  - ✅ 不同设备类型上传（kiosk/tablet/mobile）
  - ✅ 获取设备状态
  - ✅ 404端点处理
- **测试场景：**
  - 设备信息上传
  - 设备状态查询
  - 多设备类型测试
  - 认证测试

### 4. 菜单模块 (Menu) - 菜单管理

#### 4.1 `tests/menu/test_get_menu.py`
**验证目的：** 菜单获取功能测试
- **API目标：** 
  - `/v1/menu/categories` (菜单分类)
  - `/v1/menu/items` (菜单项目)
  - `/v1/menu/search` (菜单搜索)
- **请求方法：** GET
- **验证点：**
  - ✅ 获取菜单分类列表
  - ✅ 获取菜单项目列表
  - ✅ 按分类获取菜单项目
  - ✅ 获取菜单项目详情
  - ✅ 带位置信息获取菜单
  - ✅ 搜索菜单项目
  - ✅ 多个分类测试
- **测试场景：**
  - 菜单分类查询
  - 菜单项目查询
  - 菜单搜索
  - 多分类测试

### 5. 积分模块 (Loyalty) - 积分和奖励系统

#### 5.1 `tests/loyalty/test_list_reward_tiers.py`
**验证目的：** 积分等级和奖励功能测试
- **API目标：** 
  - `/v1/loyalty/reward-tiers` (积分等级)
  - `/v1/loyalty/user-info` (用户积分)
  - `/v1/loyalty/rewards` (积分奖励)
  - `/v1/loyalty/transactions` (积分交易)
- **请求方法：** GET
- **验证点：**
  - ✅ 获取积分等级列表
  - ✅ 带位置信息获取积分等级
  - ✅ 获取用户积分信息
  - ✅ 获取积分奖励
  - ✅ 获取积分交易记录
  - ✅ 不同积分等级测试
- **测试场景：**
  - 积分等级查询
  - 用户积分查询
  - 积分奖励查询
  - 交易记录查询

### 6. 订单模块 (Order) - 订单管理

#### 6.1 `tests/order/test_create_order.py`
**验证目的：** 订单创建功能测试
- **API目标：** `/v1/orders`
- **请求方法：** POST
- **验证点：**
  - ✅ 创建订单成功
  - ✅ 带token创建订单
  - ✅ 无效商品处理
  - ✅ 空商品列表处理
  - ✅ 不同支付方式测试
- **测试场景：**
  - 订单创建
  - 商品验证
  - 支付方式测试
  - 错误处理

#### 6.2 `tests/order/test_get_order.py`
**验证目的：** 订单查询功能测试
- **API目标：** `/v1/orders`
- **请求方法：** GET
- **验证点：**
  - ✅ 获取订单列表
  - ✅ 获取订单详情
  - ✅ 按状态筛选订单
  - ✅ 按日期范围筛选
  - ✅ 按位置筛选订单
- **测试场景：**
  - 订单列表查询
  - 订单详情查询
  - 订单筛选
  - 多条件查询

#### 6.3 `tests/order/test_update_order.py`
**验证目的：** 订单更新功能测试
- **API目标：** `/v1/orders/{order_id}`
- **请求方法：** PUT/PATCH/DELETE
- **验证点：**
  - ✅ 更新订单状态
  - ✅ 更新订单商品
  - ✅ 更新取餐时间
  - ✅ 取消订单
  - ✅ 无效状态处理
- **测试场景：**
  - 订单状态更新
  - 订单内容修改
  - 订单取消
  - 错误处理

### 7. 支付模块 (Payment) - 支付处理

#### 7.1 `tests/payment/test_payment_methods.py`
**验证目的：** 支付功能测试
- **API目标：** 
  - `/v1/payment/methods` (支付方式)
  - `/v1/payment/process` (支付处理)
  - `/v1/payment/history` (支付历史)
- **请求方法：** GET/POST
- **验证点：**
  - ✅ 获取支付方式列表
  - ✅ 处理支付
  - ✅ 获取支付状态
  - ✅ 退款处理
  - ✅ 获取支付历史
  - ✅ 不同支付方式测试
  - ✅ 无效金额处理
- **测试场景：**
  - 支付方式查询
  - 支付处理
  - 支付状态查询
  - 退款处理
  - 支付历史查询

### 8. 用户模块 (User) - 用户资料管理

#### 8.1 `tests/user/test_user_profile.py`
**验证目的：** 用户资料管理功能测试
- **API目标：** 
  - `/v1/user/profile` (用户资料)
  - `/v1/user/preferences` (用户偏好)
  - `/v1/user/orders` (用户订单)
- **请求方法：** GET/PUT
- **验证点：**
  - ✅ 获取用户资料
  - ✅ 更新用户资料
  - ✅ 更新用户偏好设置
  - ✅ 获取用户偏好设置
  - ✅ 获取用户订单历史
  - ✅ 获取用户收藏
  - ✅ 添加/移除收藏
  - ✅ 无效邮箱格式处理
- **测试场景：**
  - 用户资料查询
  - 用户资料更新
  - 用户偏好设置
  - 用户订单历史
  - 用户收藏管理

### 9. 基础测试 (Base) - 基础功能验证

#### 9.1 `tests/base_test.py`
**验证目的：** API基础功能测试
- **API目标：** 基础连接和认证
- **验证点：**
  - ✅ API连接性测试
  - ✅ 认证头信息验证
  - ✅ API验证器功能测试
  - ✅ 通用请求方法测试
  - ✅ JSON响应处理
  - ✅ 错误响应处理
- **测试场景：**
  - 网络连接测试
  - 认证机制测试
  - 请求方法测试
  - 响应格式测试

## 📊 测试覆盖统计

| 模块 | 测试文件数 | 测试用例数 | 主要功能 |
|------|------------|------------|----------|
| 登录模块 | 4 | 33 | 用户认证、注册、登录 |
| 验证模块 | 1 | 22 | 验证码发送、验证 |
| 位置模块 | 2 | 12 | 位置信息、设备管理 |
| 菜单模块 | 1 | 7 | 菜单查询、搜索 |
| 积分模块 | 1 | 8 | 积分等级、奖励 |
| 订单模块 | 3 | 25 | 订单创建、查询、更新 |
| 支付模块 | 1 | 12 | 支付处理、状态查询 |
| 用户模块 | 1 | 15 | 用户资料、偏好管理 |
| 基础测试 | 1 | 3 | 基础功能验证 |

**总计：**
- **测试文件数：** 15个
- **测试用例数：** 137+个
- **覆盖模块：** 9个主要功能模块
- **API端点：** 30+个不同的API端点

## 🎯 验证目标总结

每个测试脚本都专注于验证以下方面：

### 1. 功能正确性
- API是否按预期工作
- 业务逻辑是否正确实现
- 数据流转是否正常

### 2. 错误处理
- 无效输入的处理
- 异常情况的处理
- 错误响应的格式

### 3. 边界条件
- 极端情况的处理
- 参数边界值测试
- 性能边界测试

### 4. 参数验证
- 必需参数的处理
- 可选参数的处理
- 参数格式验证

### 5. 状态码验证
- HTTP状态码的正确性
- 成功响应的状态码
- 错误响应的状态码

### 6. 响应格式
- JSON响应的结构
- 响应内容的完整性
- 数据类型的正确性

### 7. 认证机制
- Token的处理
- 认证头的验证
- 权限控制

## 🚀 运行测试

### 运行所有测试
```bash
python -m pytest tests/ -v
```

### 运行特定模块
```bash
python -m pytest tests/login/ -v
python -m pytest tests/verification/ -v
python -m pytest tests/location/ -v
```

### 运行特定测试文件
```bash
python -m pytest tests/login/test_login_phone.py -v
```

### 生成HTML报告
```bash
python -m pytest tests/ -v --html=test_report.html --self-contained-html
```

## 📝 注意事项

1. **API可用性**：测试前确保API服务器正常运行
2. **环境配置**：检查 `config/env_config.py` 中的配置
3. **认证信息**：确保认证头信息正确配置
4. **测试数据**：使用测试专用的数据，避免影响生产环境
5. **错误处理**：测试框架已包含API不可用时的跳过逻辑

## 🔧 维护指南

1. **添加新测试**：按照现有模式添加新的测试用例
2. **更新API端点**：当API发生变化时，及时更新测试用例
3. **扩展验证点**：根据业务需求添加新的验证点
4. **性能测试**：考虑添加性能测试用例
5. **安全测试**：考虑添加安全相关的测试用例

---

*最后更新：2024年7月29日*
*版本：1.0* 