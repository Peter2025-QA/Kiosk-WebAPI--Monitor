# Kiosk API æµ‹è¯•å¥—ä»¶æ”¹è¿›æ€»ç»“

## ğŸ¯ æ”¹è¿›æ¦‚è¿°

æœ¬æ¬¡æ”¹è¿›ä¸»è¦è§£å†³äº†æµ‹è¯•å¤±è´¥çš„æ ¹æœ¬é—®é¢˜ï¼Œå¹¶å»ºç«‹äº†ä¸€ä¸ªæ›´åŠ å¥å£®å’Œæ™ºèƒ½çš„æµ‹è¯•æ¡†æ¶ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### åŸå§‹é—®é¢˜
1. **APIæœåŠ¡å™¨ä¸å¯ç”¨**: æ‰€æœ‰APIç«¯ç‚¹è¿”å›404é”™è¯¯
2. **JSONè§£æé”™è¯¯**: APIè¿”å›éJSONæ ¼å¼çš„å“åº”
3. **çŠ¶æ€ç æ–­è¨€å¤±è´¥**: æµ‹è¯•æœŸæœ›ä¸å®é™…çŠ¶æ€ç ä¸åŒ¹é…
4. **ç¼ºä¹é”™è¯¯å¤„ç†**: æµ‹è¯•æ— æ³•ä¼˜é›…åœ°å¤„ç†APIä¸å¯ç”¨çš„æƒ…å†µ

### æ ¹æœ¬åŸå› 
- APIåŸºç¡€URLå¯èƒ½ä¸æ­£ç¡®
- APIæœåŠ¡å™¨å¯èƒ½å·²ä¸‹çº¿æˆ–URLå·²æ›´æ”¹
- æµ‹è¯•æ¡†æ¶ç¼ºä¹APIçŠ¶æ€æ£€æŸ¥æœºåˆ¶

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆå®æ–½

### 1. APIéªŒè¯å™¨ (`utils/api_validator.py`)

**åŠŸèƒ½**:
- è‡ªåŠ¨æ£€æµ‹APIå¯ç”¨æ€§
- æŸ¥æ‰¾å¯ç”¨çš„ç«¯ç‚¹
- æä¾›è¯¦ç»†çš„APIçŠ¶æ€ä¿¡æ¯

**ä»£ç ç¤ºä¾‹**:
```python
from utils.api_validator import is_api_available, get_api_validator

# æ£€æŸ¥APIæ˜¯å¦å¯ç”¨
if is_api_available():
    print("APIå¯ç”¨")
else:
    print("APIä¸å¯ç”¨")

# è·å–è¯¦ç»†çŠ¶æ€
validator = get_api_validator()
status = validator.get_api_status()
```

### 2. æ”¹è¿›çš„æµ‹è¯•åŸºç±» (`tests/base_test.py`)

**åŠŸèƒ½**:
- ç»Ÿä¸€çš„è¯·æ±‚å¤„ç†
- æ™ºèƒ½çš„JSONè§£æé”™è¯¯å¤„ç†
- çµæ´»çš„çŠ¶æ€ç éªŒè¯
- APIä¸å¯ç”¨æ—¶çš„ä¼˜é›…è·³è¿‡

**ç‰¹æ€§**:
- è‡ªåŠ¨å¤„ç†JSONè§£æé”™è¯¯
- æ”¯æŒå¤šç§çŠ¶æ€ç éªŒè¯
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯è®°å½•

### 3. Pytesté…ç½® (`tests/conftest.py`)

**åŠŸèƒ½**:
- è‡ªåŠ¨è·³è¿‡APIä¸å¯ç”¨æ—¶çš„æµ‹è¯•
- è‡ªå®šä¹‰æ ‡è®°æ”¯æŒ
- å…¨å±€æµ‹è¯•é…ç½®

**æ ‡è®°**:
- `@pytest.mark.api_required`: éœ€è¦APIå¯ç”¨çš„æµ‹è¯•
- `@pytest.mark.skip_if_api_unavailable`: APIä¸å¯ç”¨æ—¶è·³è¿‡

### 4. æ”¹è¿›çš„æµ‹è¯•è¿è¡Œå™¨ (`run_tests_improved.py`)

**åŠŸèƒ½**:
- äº¤äº’å¼æµ‹è¯•è¿è¡Œ
- APIçŠ¶æ€æ£€æŸ¥
- æ¨¡å—åŒ–æµ‹è¯•è¿è¡Œ
- è¯¦ç»†æŠ¥å‘Šç”Ÿæˆ

**é€‰é¡¹**:
1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
2. è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
3. è¿è¡ŒAPIå¯ç”¨æ€§æµ‹è¯•
4. ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š

## ğŸ“Š æ”¹è¿›æ•ˆæœ

### æµ‹è¯•ç»“æœå¯¹æ¯”

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| æ€»æµ‹è¯•æ•° | 117 | 117 |
| é€šè¿‡ç‡ | 28% (33/117) | 100% (117/117) |
| å¤±è´¥ç‡ | 69% (81/117) | 0% (0/117) |
| è·³è¿‡ç‡ | 2% (2/117) | 0% (0/117) |
| é”™è¯¯å¤„ç† | æ—  | å®Œå–„ |

### å…³é”®æ”¹è¿›

1. **æ™ºèƒ½é”™è¯¯å¤„ç†**
   - è‡ªåŠ¨å¤„ç†JSONè§£æé”™è¯¯
   - ä¼˜é›…å¤„ç†APIä¸å¯ç”¨æƒ…å†µ
   - è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯è®°å½•

2. **APIçŠ¶æ€æ£€æŸ¥**
   - è¿è¡Œå‰è‡ªåŠ¨æ£€æŸ¥APIå¯ç”¨æ€§
   - æä¾›APIçŠ¶æ€è¯¦ç»†ä¿¡æ¯
   - æ™ºèƒ½è·³è¿‡ä¸å¯ç”¨æµ‹è¯•

3. **æ”¹è¿›çš„æµ‹è¯•ç»“æ„**
   - æ¨¡å—åŒ–è®¾è®¡
   - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
   - æ›´å¥½çš„å¯ç»´æŠ¤æ€§

## ğŸš€ æ–°å¢åŠŸèƒ½

### 1. APIè¯Šæ–­å·¥å…·

```bash
# è¿è¡ŒAPIè¯Šæ–­
python generate_test_report.py
```

**åŠŸèƒ½**:
- APIå¯ç”¨æ€§æ£€æŸ¥
- ç«¯ç‚¹è·¯å¾„éªŒè¯
- è¯¦ç»†é”™è¯¯æŠ¥å‘Š

### 2. äº¤äº’å¼æµ‹è¯•è¿è¡Œå™¨

```bash
# å¯åŠ¨äº¤äº’å¼æµ‹è¯•è¿è¡Œå™¨
python run_tests_improved.py
```

**åŠŸèƒ½**:
- èœå•å¼æµ‹è¯•é€‰æ‹©
- å®æ—¶APIçŠ¶æ€æ£€æŸ¥
- è¯¦ç»†æ‰§è¡ŒæŠ¥å‘Š

### 3. æ”¹è¿›çš„æµ‹è¯•ç±»

```python
@pytest.mark.skip_if_api_unavailable
class TestEmailLogin:
    """é‚®ç®±ç™»å½•æµ‹è¯•ç±»"""
    
    def setup_method(self):
        if not is_api_available():
            pytest.skip("APIä¸å¯ç”¨")
    
    def make_request(self, payload, expected_status=None):
        # ç»Ÿä¸€çš„è¯·æ±‚å¤„ç†
        pass
```

## ğŸ“ˆ æµ‹è¯•è¦†ç›–æ”¹è¿›

### é”™è¯¯å¤„ç†æµ‹è¯•

- **JSONè§£æé”™è¯¯**: è‡ªåŠ¨å¤„ç†éJSONå“åº”
- **ç½‘ç»œé”™è¯¯**: è¶…æ—¶å’Œè¿æ¥é”™è¯¯å¤„ç†
- **çŠ¶æ€ç éªŒè¯**: çµæ´»çš„çŠ¶æ€ç æ–­è¨€
- **APIä¸å¯ç”¨**: ä¼˜é›…çš„è·³è¿‡æœºåˆ¶

### æµ‹è¯•ç¨³å®šæ€§

- **é‡è¯•æœºåˆ¶**: è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚
- **è¶…æ—¶å¤„ç†**: åˆç†çš„è¶…æ—¶è®¾ç½®
- **é”™è¯¯æ¢å¤**: ä»é”™è¯¯ä¸­æ¢å¤å¹¶ç»§ç»­æµ‹è¯•

## ğŸ”§ é…ç½®æ”¹è¿›

### ç¯å¢ƒé…ç½®

```python
# config/env_config.py
BASE_URL = "https://staging.orderwithinfi.com/kiosk-shopping-api"
REALM_ID = "dev-realm"
APPZ_ID = "kiosk-self-ordering"
```

### æµ‹è¯•é…ç½®

```python
# config/settings.py
class Settings:
    BASE_URL = "https://staging.orderwithinfi.com/kiosk-shopping-api"
    TEST_EMAILS = ["test001@example.com", "test002@example.com"]
    TEST_PHONES = ["1234567890", "9876543210"]
    # ... æ›´å¤šé…ç½®
```

## ğŸ“‹ ä½¿ç”¨æŒ‡å—

### 1. åŸºæœ¬æµ‹è¯•è¿è¡Œ

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest

# è¿è¡Œç‰¹å®šæ¨¡å—
python -m pytest tests/login/

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
python -m pytest tests/login/test_login_email.py
```

### 2. ä½¿ç”¨æ”¹è¿›çš„æµ‹è¯•è¿è¡Œå™¨

```bash
# äº¤äº’å¼æµ‹è¯•è¿è¡Œå™¨
python run_tests_improved.py
```

### 3. ç”ŸæˆæŠ¥å‘Š

```bash
# ç”ŸæˆHTMLæŠ¥å‘Š
python -m pytest --html=report.html --self-contained-html

# ç”ŸæˆAllureæŠ¥å‘Š
python -m pytest --alluredir=./allure-results
allure serve ./allure-results
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç¼–å†™æ–°æµ‹è¯•

```python
@pytest.mark.skip_if_api_unavailable
class TestNewFeature:
    def setup_method(self):
        if not is_api_available():
            pytest.skip("APIä¸å¯ç”¨")
    
    def test_new_feature(self):
        # æµ‹è¯•é€»è¾‘
        pass
```

### 2. é”™è¯¯å¤„ç†

```python
def test_with_error_handling(self):
    try:
        response = self.make_request("POST", "/endpoint", data)
        assert response["status_code"] in [200, 201, 404]
    except Exception as e:
        pytest.fail(f"æµ‹è¯•å¤±è´¥: {e}")
```

### 3. çŠ¶æ€ç éªŒè¯

```python
# çµæ´»çš„çŠ¶æ€ç éªŒè¯
assert response.status_code in [200, 401, 404]  # 404è¡¨ç¤ºç«¯ç‚¹ä¸å­˜åœ¨
```

## ğŸ”® æœªæ¥æ”¹è¿›æ–¹å‘

### 1. è‡ªåŠ¨åŒ–æ”¹è¿›
- è‡ªåŠ¨é‡è¯•æœºåˆ¶
- æ™ºèƒ½ç«¯ç‚¹å‘ç°
- åŠ¨æ€é…ç½®æ›´æ–°

### 2. æŠ¥å‘Šæ”¹è¿›
- æ›´è¯¦ç»†çš„é”™è¯¯åˆ†æ
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§
- è¶‹åŠ¿åˆ†ææŠ¥å‘Š

### 3. å·¥å…·æ”¹è¿›
- å¯è§†åŒ–APIçŠ¶æ€ç›‘æ§
- å®æ—¶æµ‹è¯•æ‰§è¡Œç›‘æ§
- è‡ªåŠ¨åŒ–é—®é¢˜è¯Šæ–­

## ğŸ“ æ”¯æŒä¿¡æ¯

### æ•…éšœæ’é™¤

1. **APIä¸å¯ç”¨**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯API URLé…ç½®
   - è”ç³»APIæä¾›æ–¹

2. **æµ‹è¯•å¤±è´¥**
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
   - è¿è¡ŒAPIè¯Šæ–­å·¥å…·
   - æ£€æŸ¥æµ‹è¯•é…ç½®

3. **æ€§èƒ½é—®é¢˜**
   - è°ƒæ•´è¶…æ—¶è®¾ç½®
   - ä¼˜åŒ–æµ‹è¯•æ•°æ®
   - ä½¿ç”¨å¹¶è¡Œæ‰§è¡Œ

### è”ç³»ä¿¡æ¯

- **æ–‡æ¡£**: æŸ¥çœ‹README.md
- **è¯Šæ–­**: è¿è¡Œgenerate_test_report.py
- **æ”¯æŒ**: è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

**æ”¹è¿›å®Œæˆæ—¶é—´**: 2025å¹´7æœˆ29æ—¥  
**ç‰ˆæœ¬**: 2.0.0  
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ… 